description: >
  Restores the latest backup available of an environment to Skpr.

parameters:
  docker_image_tag:
    default: "skpr/cli:latest"
    description: "The Skpr CLI version tag"
    type: string
  source:
    type: string
    description: "The source environment to grab the backup from"
  target:
    type: string
    description: "The target environment to restore the backup to"
  timeout:
    type: string
    description: "How long to wait for the build to complete"
    default: "1h"
  title:
    type: string
    description: "Tile of the job to appear in CircleCI's interface."
    default: "Skpr Restore"

steps:
  - run:
      environment:
        SKPR_CLI_DOCKER_IMAGE: <<parameters.docker_image_tag>>
        SKPR_SOURCE: <<parameters.source>>
        SKPR_TARGET: <<parameters.target>>
      name: <<parameters.title>>
      command: <<include(scripts/restore.sh)>>
      no_output_timeout: <<parameters.timeout>>
